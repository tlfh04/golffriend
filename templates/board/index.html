{% extends 'base.html' %}
{% block con %}
{% load mathfilters %}

<style>
    .interval-cell {
       width: 80px;
    }

    .table {
        text-align: center;
    }
</style>

<h1><b>ë³´ë“œ</b></h1>
<br>
<form>
    <div class="row">
        <div class="col-sm-2">
            <input type="date" id="now_date" class = "form-control" name = "fdate" value="{{object.date|date:'Y-m-d'}}" style="width:180px;">
        </div>
        <div class="col-sm-2">
            <input type="date" class = "form-control" name = "ldate" style="width:180px;">
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col-sm-2">
            <select class="form-select" name="cate">
                <option value="gn" {% if cate == "gn" %} selected {% endif %}>ê³¨í”„ì¥</option>
                <option value="wri" {% if cate == "wri" %} selected {% endif %}>ì‘ì„±ì</option>
                <option value="cos" {% if cate == "con" %} selected {% endif %}>ì½”ìŠ¤</option>
                <option value="con" {% if cate == "con" %} selected {% endif %}>ê³ ê°ëª…</option>
                <option value="ho" {% if cate == "con" %} selected {% endif %}>ì‹œê°„</option>
            </select>
        </div>
        <div class="col-sm-8">
            <input type="text" name="kw" value="{{kw}}" class="form-control" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
        </div>
        <div class="col-sm-1">
            <button class="btn btn-dark" style="width: 100%;">ê²€ìƒ‰</button>
        </div>
        <div class="col-sm-1">
            <a class="btn btn-secondary" href="{% url 'board:index' %}" style="width: 100%;">ì´ˆê¸°í™”</a>
        </div>
    </div>
</form>

    <div class="text-end">
        <a class="btn btn-dark" href="{% url 'board:create' %}">WRITE</a>
    </div>
    
    <table border = "1" class="table table-hover table-bordered border-dark table align-middle mt-4">
        <thead>
            <tr class="table-dark">
                <th scope="col">ì˜ˆì•½ì¼</th>
                <th scope="col">ê³¨ë“œì¥</th>
                <th scope="col">íƒ€ì„</th>
                <th scope="col">ì½”ìŠ¤</th>
                <th scope="col">ì˜ˆì•½ìëª…</th>
                <th scope="col">ê·¸ë¦°í”¼</th>
                <th scope="col">ì¡°ì¸ì¸ì›</th>
                <th scope="col">ì¡°ê±´</th>
                <th scope="col">ë©”ëª¨</th>
                <th scope="col">íŒë§¤</th>
                <th scope="col" colspan="4" id="dynamic-col">ì¡°ì¸í˜„í™©</th>
            </tr>
        </thead>
        <tbody id="table">
            {% for i in bset %}
            {% if i.join_count < 4 %}
                <tr>
                    <th scope="row" class="date-format">{{ i.date|date:"m/d(D)"}}</td>
                    <td>{{ i.gn }}</td>
                    <td>{{ i.hour }}:{{ i.min }}</td>
                    <td>{{ i.course }}</td>
                    <td>{{ i.bname }}</td>
                    <td>{{ i.pee }}</td>
                    <td>{{ i.join_count }}ëª…</td>
                    <td>{{ i.rq }}</td>
                    <td>{{ i.memo }}</td>
                    <td><a href="{% url 'board:sell' i.id%}" class="btn btn-dark">íŒë§¤</a></td>
                    
                    {% for j in p %}
                        {% if j.board.id == i.id %}
                            <td class='interval-cell' {% if user == j.j_writer %} style="background-color:#4391ef;"{% endif %}>{{ j.j_name }}({{ j.j_tag }})</td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endif %}
            {% empty %}
                <tr class="text-center">
                    <th colspan="13"><h4>{% if kw %} ê²€ìƒ‰ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ {% else %} íƒ€ì„ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ ğŸ’¦ {% endif %}</h4></th>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script>
    document.getElementById('now_date').valueAsDate = new Date();
    var longest = 0;

    for (i=0;i<document.getElementById('table').rows.length;i++) {
        if (document.getElementById('table').rows[i].cells.length > longest ) {
            longest = document.getElementById('table').rows[i].cells.length;
        }
    }

    if (longest > 14) {
        $("#dynamic-col").attr("colspan", longest-10);
        for (i=0;i<document.getElementById('table').rows.length;i++) {
            for (j=document.getElementById('table').rows[i].cells.length;j<longest;j++) {
                var objCell = document.getElementById('table').rows[i].insertCell(j);
                objCell.className = "interval-cell";
            }
        }
    } else {
        for (i=0;i<document.getElementById('table').rows.length;i++) {
            for (j=document.getElementById('table').rows[i].cells.length;j<14;j++) {
                var objCell = document.getElementById('table').rows[i].insertCell(j);
                objCell.className = "interval-cell";
            }
        }
    }

    for (i=0;i<document.getElementsByClassName('date-format').length;i++) {
        let x = document.getElementsByClassName("date-format")[i];
        x.innerText=x.innerText.substr(0, 7) + x.innerText.substr(9, 9); 
    }

</script>
{% endblock %}