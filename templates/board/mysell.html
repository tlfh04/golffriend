{% extends 'base.html' %}
{% block con %}
{% load mathfilters %}


<style>
   .interval-cell {
       width: 80px;
    }

    .table {
        text-align: center;
    }
</style>

<h1><b>ë‚˜ì˜ íŒë§¤ í˜„í™©</b></h1>
<h3><b>ì´ë²ˆ ë‹¬ ìˆ˜ìˆ˜ë£Œ: {{ salaryRecord.price }} ì´ë²ˆë‹¬ ëª…ìˆ˜ :  {{ salaryRecord.join_count }}</b></h3>


<table class="table table-hover table-bordered border-dark table align-middle mt-4">
    <thead>
        <tr class="table-dark">
            <th scope="col">ê³¨ë“œì¥</th>
            <th scope="col">ì˜ˆì•½ì¼</th>
            <th scope="col">ì½”ìŠ¤</th>
            <th scope="col">íƒ€ì„</th>
            <th scope="col">ì˜ˆì•½ìëª…</th>
            <th scope="col">ê·¸ë¦°í”¼</th>
            <th scope="col">ì¡°ì¸ì¸ì›</th>
            <th scope="col">ì¡°ê±´</th>
            <th scope="col">ë©”ëª¨</th>
            <th scope="col">ì§„í–‰ìƒí™©</th>
            <th scope="col">íŒë§¤</th>
            <th scope="col" colspan="4" id="dynamic-col">ì¡°ì¸í˜„í™©</th>
        </tr>
    </thead>
    <tbody id="table">
        {% for j in p %}
            <tr>
                <th scope="row">{{ j.board.gn }}</td>
                <td class="date-format">{{ j.board.date|date:"m/d(D)"}}</td>
                <td>{{ j.board.course }}</td>
                <td>{{ j.board.hour }}:{{ j.board.min }}</td>
                <td>{{ j.board.bname }}</td>
                <td>{{ j.board.pee }}</td>
                <td>{{ j.join_count }}ëª…</td>
                <td>{{ j.board.rq }}</td>
                <td>{{ j.board.memo }}</td>

                <!-- ì§„í–‰ìƒí™© -->
                {% if j.deposit_status == False %}
                    <td>ë¯¸ì…ê¸ˆ</td>
                {% else %}
                    <td>ì…ê¸ˆ í™•ì¸</td>
                {% endif %}

                <!-- íŒë§¤ -->
                {% if j.deposit_status == False %}
                    {% if j.deposit_request == False %}
                        <td><button onclick="depositSubmit('{{j.id}}')" class="btn btn-dark">ì…ê¸ˆìš”ì²­</button></td>
                    {% else %}
                        <td><button onclick="depositSubmit('{{j.id}}')" class="btn btn-dark">ì…ê¸ˆìš”ì²­ì·¨ì†Œ</button></td>
                    {% endif %}
                {% else %}
                {% if j.refund_request == False %}
                <td><button onclick="requestRefund('{{j.id}}')" class="btn btn-dark" >í™˜ë¶ˆìš”ì²­</button></td>
                {% else %}
                <td><button onclick="requestRefund('{{j.id}}')" class="btn btn-dark" disabled>í™˜ë¶ˆìš”ì²­</button></td>

                {% endif %}
                {% endif %}
                
                    {% if user == j.j_writer %}
                        <td class='interval-cell'>{{ j.j_name }}({{ j.j_tag }})</td>
                    {% endif %}
            </tr>
        {% empty %}
            <tr class="text-center">
                <th colspan="1">{% if kw %} ê²€ìƒ‰ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ {% else %} íƒ€ì„ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ ğŸ’¦ {% endif %}</th>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script>

    for (i=0;i<document.getElementsByClassName('date-format').length;i++) {
        let x = document.getElementsByClassName("date-format")[i];
        x.innerText=x.innerText.substr(0, 7) + x.innerText.substr(9, 9); 
    }


    function depositSubmit(joinookId) {
        $.ajax({
            url: "{% url 'board:requestDeposit' %}",
            type:'POST',
            data:{'joinookId':joinookId,csrfmiddlewaretoken: '{{ csrf_token }}'},
            success:function(response){
                console.log(response.message);
                if (response.message == 'true') {
                    alert("ì…ê¸ˆìš”ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.") //ë“±ë¡ ì•Œë¦¼
                } else {
                    alert("ì…ê¸ˆìš”ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")
                }
                location.reload();
            },
            error:function(response){
            }
        });
    
	}

    function requestRefund(joinookId) {
        $.ajax({
            url: "{% url 'board:requestRefund' %}",
            type:'POST',
            data:{'joinookId':joinookId,csrfmiddlewaretoken: '{{ csrf_token }}'},
            success:function(response){
                console.log(response.message);
                alert("í™˜ë¶ˆìš”ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
                location.reload();
            },
            error:function(response){
            }
        });
    
	}

</script>
{% endblock %}